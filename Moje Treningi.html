<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-align=1.0">
    <title>Moje Treningi</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Dumbbell = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6.5 6.5L17.5 17.5"></path>
                <path d="M6.5 17.5L17.5 6.5"></path>
                <circle cx="6.5" cy="6.5" r="2"></circle>
                <circle cx="17.5" cy="17.5" r="2"></circle>
                <circle cx="17.5" cy="6.5" r="2"></circle>
                <circle cx="6.5" cy="17.5" r="2"></circle>
            </svg>
        );

        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const WorkoutTracker = () => {
            const [workouts, setWorkouts] = useState([]);
            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const [initialized, setInitialized] = useState(false);

            const monthNames = ['Stycze≈Ñ', 'Luty', 'Marzec', 'Kwiecie≈Ñ', 'Maj', 'Czerwiec', 
                               'Lipiec', 'Sierpie≈Ñ', 'Wrzesie≈Ñ', 'Pa≈∫dziernik', 'Listopad', 'Grudzie≈Ñ'];
            const dayNames = ['Pon', 'Wt', '≈ör', 'Czw', 'Pt', 'Sob', 'Ndz'];

            useEffect(() => {
                const saved = localStorage.getItem('workouts');
                const isInit = localStorage.getItem('workoutsInitialized');
                
                if (saved) {
                    setWorkouts(JSON.parse(saved));
                } else if (!isInit) {
                    // Initialize with Feb 3rd Pull workout
                    const initialWorkout = {
                        id: Date.now(),
                        date: '2026-02-03',
                        type: 'Pull',
                        timestamp: new Date('2026-02-03').toISOString()
                    };
                    setWorkouts([initialWorkout]);
                    localStorage.setItem('workoutsInitialized', 'true');
                }
                setInitialized(true);
            }, []);

            useEffect(() => {
                localStorage.setItem('workouts', JSON.stringify(workouts));
            }, [workouts]);

            const getDateString = (date) => {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            };

            const addWorkout = (date, type) => {
                const dateStr = getDateString(date);
                const existing = workouts.find(w => w.date === dateStr);
                
                if (existing) {
                    setWorkouts(workouts.map(w => 
                        w.date === dateStr ? { ...w, type } : w
                    ));
                } else {
                    setWorkouts([...workouts, {
                        id: Date.now(),
                        date: dateStr,
                        type: type,
                        timestamp: new Date().toISOString()
                    }]);
                }
            };

            const removeWorkout = (dateStr) => {
                setWorkouts(workouts.filter(w => w.date !== dateStr));
            };

            const getWorkoutForDate = (date) => {
                const dateStr = getDateString(date);
                return workouts.find(w => w.date === dateStr);
            };

            const getSuggestedType = () => {
                const sortedWorkouts = [...workouts].sort((a, b) => 
                    new Date(b.date).getTime() - new Date(a.date).getTime()
                );
                
                if (sortedWorkouts.length === 0) return 'Push';
                
                const lastWorkout = sortedWorkouts[0];
                return lastWorkout.type === 'Push' ? 'Pull' : 'Push';
            };

            const getPlannedWorkout = (date) => {
                const dateStr = getDateString(date);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const checkDate = new Date(date);
                checkDate.setHours(0, 0, 0, 0);
                
                // Don't show planned for past dates
                if (checkDate < today) {
                    return null;
                }
                
                // If there's an actual workout, don't show planned
                if (getWorkoutForDate(date)) {
                    return null;
                }
                
                // Find the last actual workout before or on this date
                const sortedWorkouts = [...workouts]
                    .filter(w => new Date(w.date) <= checkDate)
                    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
                
                if (sortedWorkouts.length === 0) return null;
                
                const lastWorkout = new Date(sortedWorkouts[0].date);
                lastWorkout.setHours(0, 0, 0, 0);
                
                const daysSince = Math.floor((checkDate.getTime() - lastWorkout.getTime()) / (1000 * 60 * 60 * 24));
                
                // Show REST on day 1 after workout
                if (daysSince === 1) {
                    return 'REST';
                }
                
                // Show next workout on day 2
                if (daysSince === 2) {
                    return sortedWorkouts[0].type === 'Push' ? 'Pull' : 'Push';
                }
                
                return null;
            };

            const getDaysInMonth = (month, year) => {
                return new Date(year, month + 1, 0).getDate();
            };

            const getFirstDayOfMonth = (month, year) => {
                const day = new Date(year, month, 1).getDay();
                return day === 0 ? 6 : day - 1; // Convert to Monday = 0
            };

            const getCalendarDays = () => {
                const daysInMonth = getDaysInMonth(currentMonth, currentYear);
                const firstDay = getFirstDayOfMonth(currentMonth, currentYear);
                const days = [];

                // Empty cells before first day
                for (let i = 0; i < firstDay; i++) {
                    days.push(null);
                }

                // Days of month
                for (let day = 1; day <= daysInMonth; day++) {
                    days.push(day);
                }

                return days;
            };

            const changeMonth = (delta) => {
                let newMonth = currentMonth + delta;
                let newYear = currentYear;

                if (newMonth > 11) {
                    newMonth = 0;
                    newYear++;
                } else if (newMonth < 0) {
                    newMonth = 11;
                    newYear--;
                }

                setCurrentMonth(newMonth);
                setCurrentYear(newYear);
            };

            const getMonthStats = () => {
                const monthWorkouts = workouts.filter(w => {
                    const date = new Date(w.date);
                    return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
                });

                const pushCount = monthWorkouts.filter(w => w.type === 'Push').length;
                const pullCount = monthWorkouts.filter(w => w.type === 'Pull').length;

                return {
                    total: monthWorkouts.length,
                    push: pushCount,
                    pull: pullCount
                };
            };

            const getCurrentStreak = () => {
                if (workouts.length === 0) return 0;
                
                const sortedWorkouts = [...workouts]
                    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let streak = 0;
                let expectedDate = new Date(today);
                
                // Check if there's a workout today or yesterday (to account for flexibility)
                const lastWorkoutDate = new Date(sortedWorkouts[0].date);
                lastWorkoutDate.setHours(0, 0, 0, 0);
                
                const daysSinceLastWorkout = Math.floor((today.getTime() - lastWorkoutDate.getTime()) / (1000 * 60 * 60 * 24));
                
                // If last workout was more than 2 days ago, streak is broken
                if (daysSinceLastWorkout > 2) return 0;
                
                // Start checking from the most recent workout
                for (let i = 0; i < sortedWorkouts.length - 1; i++) {
                    const currentDate = new Date(sortedWorkouts[i].date);
                    const nextDate = new Date(sortedWorkouts[i + 1].date);
                    
                    currentDate.setHours(0, 0, 0, 0);
                    nextDate.setHours(0, 0, 0, 0);
                    
                    const daysDiff = Math.floor((currentDate.getTime() - nextDate.getTime()) / (1000 * 60 * 60 * 24));
                    
                    // Check if the gap is 2 days (perfect) or 3 days (one day rest + training day)
                    if (daysDiff >= 2 && daysDiff <= 3) {
                        streak++;
                    } else {
                        // Streak is broken
                        break;
                    }
                }
                
                // Add 1 to include the most recent workout
                return streak + 1;
            };

            const getAverageWorkoutsPerWeek = () => {
                if (workouts.length === 0) return 0;
                
                const sortedWorkouts = [...workouts].sort((a, b) => 
                    new Date(a.date).getTime() - new Date(b.date).getTime()
                );
                
                const firstWorkout = new Date(sortedWorkouts[0].date);
                const lastWorkout = new Date(sortedWorkouts[sortedWorkouts.length - 1].date);
                
                const daysDiff = Math.floor((lastWorkout.getTime() - firstWorkout.getTime()) / (1000 * 60 * 60 * 24));
                const weeks = daysDiff / 7;
                
                if (weeks < 1) return workouts.length; // Less than a week
                
                return (workouts.length / weeks).toFixed(1);
            };

            const isToday = (day) => {
                const today = new Date();
                return day === today.getDate() && 
                       currentMonth === today.getMonth() && 
                       currentYear === today.getFullYear();
            };

            const handleDayClick = (day) => {
                const date = new Date(currentYear, currentMonth, day);
                const workout = getWorkoutForDate(date);
                const planned = getPlannedWorkout(date);
                
                if (workout) {
                    // Has actual workout - allow removal
                    if (window.confirm(`UsunƒÖƒá trening ${workout.type} z ${day} ${monthNames[currentMonth]}?`)) {
                        removeWorkout(getDateString(date));
                    }
                } else if (planned && planned !== 'REST') {
                    // Has planned workout (not REST) - quick confirm
                    if (window.confirm(`Potwierdziƒá trening ${planned}?`)) {
                        addWorkout(date, planned);
                    }
                } else if (planned === 'REST') {
                    // REST day - just show message
                    alert('To dzie≈Ñ odpoczynku! üò¥');
                } else {
                    // No workout - manual add
                    const suggested = getSuggestedType();
                    const type = window.confirm(`Dodaƒá trening ${suggested}?\n\nOK = ${suggested}\nAnuluj = ${suggested === 'Push' ? 'Pull' : 'Push'}`) 
                        ? suggested 
                        : (suggested === 'Push' ? 'Pull' : 'Push');
                    addWorkout(date, type);
                }
            };

            const stats = getMonthStats();
            const streak = getCurrentStreak();
            const suggested = getSuggestedType();
            const avgPerWeek = getAverageWorkoutsPerWeek();

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4">
                    <div className="max-w-5xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <div className="flex items-center justify-between mb-6">
                                <div className="flex items-center gap-3">
                                    <Dumbbell />
                                    <h1 className="text-3xl font-bold text-slate-800">Moje Treningi</h1>
                                </div>
                                <div className="text-right">
                                    <p className="text-sm text-slate-500">Nastƒôpny trening</p>
                                    <p className="text-2xl font-bold text-blue-600">{suggested}</p>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                                <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4">
                                    <p className="text-xs text-slate-600 mb-1">Trening√≥w w miesiƒÖcu</p>
                                    <p className="text-3xl font-bold text-blue-700">{stats.total}</p>
                                </div>
                                <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4">
                                    <p className="text-xs text-slate-600 mb-1">Push</p>
                                    <p className="text-3xl font-bold text-green-700">{stats.push}</p>
                                </div>
                                <div className="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-4">
                                    <p className="text-xs text-slate-600 mb-1">Pull</p>
                                    <p className="text-3xl font-bold text-yellow-700">{stats.pull}</p>
                                </div>
                                <div className="bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg p-4">
                                    <p className="text-xs text-slate-600 mb-1">Seria trening√≥w</p>
                                    <p className="text-3xl font-bold text-amber-700">{streak > 0 ? `üî• ${streak}` : '0'}</p>
                                </div>
                                <div className="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-lg p-4">
                                    <p className="text-xs text-slate-600 mb-1">≈örednio/tydzie≈Ñ</p>
                                    <p className="text-3xl font-bold text-indigo-700">{avgPerWeek}</p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <div className="flex items-center justify-between mb-6">
                                <button
                                    onClick={() => changeMonth(-1)}
                                    className="px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded-lg font-semibold transition-colors"
                                >
                                    ‚Üê
                                </button>
                                <h2 className="text-2xl font-bold text-slate-800">
                                    {monthNames[currentMonth]} {currentYear}
                                </h2>
                                <button
                                    onClick={() => changeMonth(1)}
                                    className="px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded-lg font-semibold transition-colors"
                                >
                                    ‚Üí
                                </button>
                            </div>

                            <div className="grid grid-cols-7 gap-2 mb-2">
                                {dayNames.map(day => (
                                    <div key={day} className="text-center text-sm font-semibold text-slate-600 p-2">
                                        {day}
                                    </div>
                                ))}
                            </div>

                            <div className="grid grid-cols-7 gap-2">
                                {getCalendarDays().map((day, index) => {
                                    if (day === null) {
                                        return <div key={`empty-${index}`} className="aspect-square"></div>;
                                    }

                                    const date = new Date(currentYear, currentMonth, day);
                                    const workout = getWorkoutForDate(date);
                                    const planned = getPlannedWorkout(date);
                                    const today = isToday(day);

                                    let bgClass = 'bg-slate-100 hover:bg-slate-200 text-slate-700';
                                    let textClass = '';
                                    
                                    if (workout) {
                                        if (workout.type === 'Push') {
                                            bgClass = 'bg-gradient-to-br from-green-400 to-green-500 text-white font-bold shadow-lg';
                                        } else {
                                            bgClass = 'bg-gradient-to-br from-yellow-400 to-yellow-500 text-white font-bold shadow-lg';
                                        }
                                    } else if (planned) {
                                        if (planned === 'REST') {
                                            bgClass = 'bg-gradient-to-br from-blue-100 to-blue-200 border-2 border-blue-300 text-blue-700 font-semibold';
                                        } else if (planned === 'Push') {
                                            bgClass = 'bg-green-100 border-2 border-green-400 border-dashed text-green-700 font-semibold';
                                        } else {
                                            bgClass = 'bg-yellow-100 border-2 border-yellow-400 border-dashed text-yellow-700 font-semibold';
                                        }
                                    }

                                    return (
                                        <button
                                            key={day}
                                            onClick={() => handleDayClick(day)}
                                            className={`aspect-square rounded-lg p-2 transition-all hover:scale-105 ${
                                                today ? 'ring-2 ring-blue-500' : ''
                                            } ${bgClass}`}
                                        >
                                            <div className="text-lg">{day}</div>
                                            {workout && (
                                                <div className="text-xs mt-1">{workout.type}</div>
                                            )}
                                            {!workout && planned && (
                                                <div className="text-xs mt-1">{planned === 'REST' ? 'üò¥' : `${planned}?`}</div>
                                            )}
                                        </button>
                                    );
                                })}
                            </div>

                            <div className="mt-6 p-4 bg-slate-50 rounded-lg">
                                <p className="text-sm text-slate-600 mb-2">
                                    <strong>Legenda:</strong>
                                </p>
                                <div className="flex gap-4 flex-wrap">
                                    <div className="flex items-center gap-2">
                                        <div className="w-6 h-6 rounded bg-gradient-to-br from-green-400 to-green-500"></div>
                                        <span className="text-sm">Push (wykonane)</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className="w-6 h-6 rounded bg-gradient-to-br from-yellow-400 to-yellow-500"></div>
                                        <span className="text-sm">Pull (wykonane)</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className="w-6 h-6 rounded bg-gradient-to-br from-blue-100 to-blue-200 border-2 border-blue-300"></div>
                                        <span className="text-sm">REST üò¥</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className="w-6 h-6 rounded bg-green-100 border-2 border-green-400 border-dashed"></div>
                                        <span className="text-sm">Planowane Push</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className="w-6 h-6 rounded bg-yellow-100 border-2 border-yellow-400 border-dashed"></div>
                                        <span className="text-sm">Planowane Pull</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <div className="w-6 h-6 rounded ring-2 ring-blue-500 bg-white"></div>
                                        <span className="text-sm">Dzisiaj</span>
                                    </div>
                                </div>
                                <p className="text-xs text-slate-500 mt-3">
                                    Kliknij na dzie≈Ñ z planowanym treningiem aby potwierdziƒá ‚úÖ
                                </p>
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl shadow-xl p-6">
                            <h2 className="text-2xl font-bold text-slate-800 mb-4">üìã Ostatnie treningi</h2>
                            <div className="space-y-2">
                                {[...workouts]
                                    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
                                    .slice(0, 10)
                                    .map(workout => {
                                        const date = new Date(workout.date);
                                        const dateStr = `${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}`;
                                        
                                        return (
                                            <div 
                                                key={workout.id} 
                                                className={`flex items-center justify-between p-3 rounded-lg ${
                                                    workout.type === 'Push' 
                                                        ? 'bg-green-50' 
                                                        : 'bg-yellow-50'
                                                }`}
                                            >
                                                <div className="flex items-center gap-3">
                                                    <span className={`px-3 py-1 rounded-full text-sm font-bold ${
                                                        workout.type === 'Push'
                                                            ? 'bg-green-500 text-white'
                                                            : 'bg-yellow-500 text-white'
                                                    }`}>
                                                        {workout.type}
                                                    </span>
                                                    <span className="font-medium text-slate-700">{dateStr}</span>
                                                </div>
                                                <button
                                                    onClick={() => removeWorkout(workout.date)}
                                                    className="text-red-500 hover:text-red-700 p-1 transition-colors"
                                                >
                                                    <Trash2 />
                                                </button>
                                            </div>
                                        );
                                    })}
                                {workouts.length === 0 && (
                                    <p className="text-slate-400 text-center py-8 italic">
                                        Jeszcze nie doda≈Çe≈õ ≈ºadnych trening√≥w. Kliknij na dzie≈Ñ w kalendarzu aby zaczƒÖƒá! üí™
                                    </p>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WorkoutTracker />);
    </script>
</body>
</html>
